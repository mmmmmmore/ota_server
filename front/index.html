<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>OTA_Management</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- 左侧菜单栏 -->
  <div class="sidebar">
    <h2>OTA_Management</h2>
    <div class="menu-item" onclick="showSection('devices')">OTA设备</div>
    <div class="menu-item" onclick="showSection('software')">OTA软件</div>
    <div class="menu-item" onclick="showSection('tasks')">OTA任务</div>
  </div>

  <!-- 主内容区 -->
  <div class="content">
    <!-- OTA设备 -->
    <div id="devices" class="section">
      <h3>已连接设备</h3>
      <table>
        <thead>
          <tr>
            <th>设备名称</th>
            <th>ECUID</th>
            <th>MacAddr</th>
            <th>IP</th>
            <th>SW_Version</th>
            <th>Current_Partition</th>
            <th>Connection</th>
            <th>Edit</th>
          </tr>
        </thead>
        <tbody id="devices-tbody">
          <!-- Dynamic Fulfill by Devices JSON-->
        </tbody>
      </table>
      <button onclick="queryDevices()">查询设备信息</button>
      <button onclick="newDevices()">创建新设备</button>
    </div>

    <!-- OTA软件 -->
    <div id="software" class="section hidden">
      <h3>可用软件版本</h3>
      <table>
        <thead>
          <tr>
            <th>版本编号</th>
            <th>生成日期</th>
            <th>适用硬件版本</th>
            <th>变化点</th>
          </tr>
        </thead>
        <tbody id="software-tbody">
          <!-- 动态填充 -->
        </tbody>
      </table>
      <button onclick="querySoftware()">查询软件版本</button>

      <!-- 新增：固件上传入口 -->
      <h4>上传新固件</h4>
      <input type="file" id="firmwareFile" />
      <input type="text" id="firmwareVersion" placeholder="版本号 (如 v1.3.0)" />
      <button onclick="uploadFirmware()">上传固件</button>
    </div>

    <!-- OTA任务 -->
    <div id="tasks" class="section hidden">
      <h3>OTA任务管理</h3>
      <table>
        <thead>
          <tr>
            <th>设备名称</th>
            <th>软件版本</th>
            <th>当前运行分区</th>
            <th>选择更新</th>
            <th>更新结果</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Vehicle_1</td>
            <td>
              <select id="ver-Vehicle_1">
                <option>v1.0.0</option>
                <option>v1.0.1</option>
                <option>v1.1.0</option>
                <option>v2.0.0</option>
              </select>
            </td>
            <td id="partition-Vehicle_1"></td>
            <td><button onclick="updateDevice('Vehicle_1')">更新</button></td>
            <td id="status-Vehicle_1">待执行</td>
          </tr>
          <tr>
            <td>Vehicle_2</td>
            <td>
              <select id="ver-Vehicle_2">
                <option>v1.0.0</option>
                <option>v1.0.1</option>
                <option>v1.1.0</option>
                <option>v2.0.0</option>
              </select>
            </td>
            <td id="partition-Vehicle_2"></td>
            <td><button onclick="updateDevice('Vehicle_2')">更新</button></td>
            <td id="status-Vehicle_2">待执行</td>
          </tr>
          <tr>
            <td>Vehicle_3</td>
            <td>
              <select id="ver-Vehicle_3">
                <option>v1.0.0</option>
                <option>v1.0.1</option>
                <option>v1.1.0</option>
                <option>v2.0.0</option>
              </select>
            </td>
            <td id="partition-Vehicle_3"></td>
            <td><button onclick="updateDevice('Vehicle_3')">更新</button></td>
            <td id="status-Vehicle_3">待执行</td>
          </tr>
          <!-- Update All-->
          <tr>
            <td>选择全部设备</td>
            <td>
                <select id="ver-All">
                    <option>v1.0.0</option>
                    <option>v1.0.1</option>
                    <option>v1.1.0</option>
                    <option>v1.2.0</option>
                    <option>v2.0.0</option>
                </select>
            </td>
            <td><!-- 全部设备更新，不显示分区 --></td>
            <td><button onclick="updateAll()">更新全部</button></td>
            <td id="status-All">待执行</td>
          </tr>
        </tbody>
      </table>

      <!-- add chart-->
      <canvas id="updateChart" width="600" height="300"></canvas>
    </div>
  </div>

  <script src="js/app.js"></script>
</body>
</html>

